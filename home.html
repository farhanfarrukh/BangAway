<!DOCTYPE html> 
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bang Away App</title>

<!--Jquery Mobile-->
<link href="css/jQuery/jquery.mobile.theme-1.3.1.min.css" rel="stylesheet" type="text/css"/>
<link href="css/jQuery/jquery.mobile.structure-1.3.1.min.css" rel="stylesheet" type="text/css"/>

<script src="lib/jQuery/jquery-1.10.0.min.js" type="text/javascript"></script>
<script src="lib/jQuery/jquery.mobile-1.3.1.js" type="text/javascript"></script>
<script src="lib/jQuery/jquery.mobile-1.3.1.min.js" type="text/javascript"></script>

<!--Jquery Custom-->
<link href="css/bangAway.css" rel="stylesheet" type="text/css">
<script src="lib/swipe.js" type="text/javascript"></script>

<script>
	
if(localStorage['userID']==0)
{
	window.location.href = "index.html";
}

$(document).ready(function() {

	if(localStorage['newcountNotify'] != 0)
	{
		$('.Ncounter').text(localStorage['newcountNotify']).show();	
	}
	else
	{
        $('this').removeClass('msg-iconh').addClass('msg-icon');
        $('.Ncounter').text('0').hide();
        $('.notif-bot').hide();
	}	

	if(localStorage['newcountNotif'] != 0)
	{
		$('.counter').text(localStorage['newcountNotif']).show();	
	}
	else
	{
        $('this').removeClass('msg-iconh').addClass('msg-icon');
        $('.counter').text('0').hide();
        $('.notif-bot').hide();
	}	

	//var ResInterval = window.setInterval('myAjaxCall()', 60000);

	var messageInterval = "http://www.paighaam.com/service/getUnreadMessages.php?state=1";
	var notificationInterval = "http://www.paighaam.com/service/getNotifications.php?uid="+localStorage['userID']+"&state=1";
	var thetitle = $('title').text();
	

	setInterval(function(){

		    jQuery.ajax({
				type: 'GET',
				url: notificationInterval,                                                                                                                                              
				dataType: 'jsonp', 
		      success: function(data) {

				var countNotif = parseInt($('.Ncounter').text());

				if(data.Count == 0 && countNotif >0)
				{
					$('.Ncounter').text(0).hide();
				}
				
				if(data.Count != 0)
				{	
						
					if(data.Count > countNotif)
					{
					
					var newcountNotif = data.Count;
					localStorage['newcountNotify']= data.Count;
					$('.Ncounter').text(newcountNotif).show();
					//$('Ntitle').text('('+newcountNotif+') '+thetitle);
					
						jQuery('<div/>', {
							id: 'notif-bot',
							class : 'notify-bot alert alert-info',
							text: 'You just got a notification!'
							}).appendTo('.notif-bot-cnt')
							.delay(5000)
							.fadeOut();
					}
				}
		      }
		    });
		}, 5000 );

		
		$('#notifications').click(function(){
                $('this').removeClass('msg-iconh').addClass('msg-icon');
                $('.Ncounter').text('0').hide();
                $('.notif-bot').hide();
                $('title').text(thetitle);
                localStorage['newcountNotify'] = 0;
                setNotificationState();
            });

           function setNotificationState()
           {
	           var setNotificationCounter = "http://www.paighaam.com/service/setNotificationState.php?uid="+localStorage['userID'];

			  jQuery.ajax({

				type: 'GET',
				url: setNotificationCounter,                                                                                                                                              
				dataType: 'jsonp',         
				success: function(data)
				{ 

				  console.log('Success!');

				},
				error: function() { console.log('Uh Oh Something Went Wrong!'); },

			  });
			}


	
	if(localStorage['role'] == "admin")
	{
		setInterval(function(){

		    jQuery.ajax({
				type: 'GET',
				url: messageInterval,                                                                                                                                              
				dataType: 'jsonp', 
		      success: function(data) {
				var countNotif = parseInt($('.counter').text());
				
				if(data.Count == 0 && countNotif >0)
				{
					$('.counter').text(0).hide();
				}

				if(data.Count != 0)
				{	
						
					var newcountNotif = data.Count;
					localStorage['newcountNotif']= data.Count;

					$('.counter').text(newcountNotif).show();
					$('title').text('('+newcountNotif+') '+ thetitle);
					
					if(data.Count > countNotif)
					{
						jQuery('<div/>', {
							id: 'notif-bot',
							class : 'notif-bot alert alert-info',
							text: 'You just got a message !'
							}).appendTo('.notif-bot-cnt')
							.delay(5000)
							.fadeOut();
					}
				}
		      }
		    });
		}, 5000 );
	}

	$('#adminApproval').hide();
	  var userID = localStorage['userID'];
	  var serviceURL = "http://www.paighaam.com/service/getUser.php?id=" + userID;

		  jQuery.ajax({

			type: 'GET',
			url: serviceURL,                                                                                                                                              
			dataType: 'jsonp',         
			success: function(data)
			{ 

			  console.log('Success!');
			  if(data.Role == "admin")
			  {
			  	$('#adminApproval').show();
			}
			  DisplayProfilePic(data.ProfilePic);
			},
			error: function() { console.log('Uh Oh Something Went Wrong!'); },

		  });

		  function CreateLocalDB(data)
		  {

		  }

		  function DisplayProfilePic(path)
		  {
			  $("#profileImg").attr("src", path);
		  }


            $('#apporvalNotify').click(function(){
                $('this').removeClass('msg-iconh').addClass('msg-icon');
                $('.counter').text('0').hide();
                $('.notif-bot').hide();
                localStorage['newcountNotif'] = 0;
                $('title').text(thetitle);
            });

             $("#logout").click(function() {
             	localStorage.clear();
             	window.location.href = "index.html";
             });

});

</script>

</head> 
<body>


<div data-role="page" id="home">
	<div data-role="header">
	</div>

	<div id="profilePic">
		<img id="profileImg" height="200px" width="200px" src=""/> 
	</div>
	<div class="ui-grid-solo" style="padding:5px; padding-top:20px">
		<div class="ui-block-a">
			<ul data-role="listview">
				<li data-icon="false"><a href="profile.html" rel="external" data-ajax="false" data-transition="slide"><img width="32px" height="32px" src="images/bangaway_profile.png" alt="details" class="cust_list_icon">Your profile</a></li>
				<!-- <li data-icon="false"><a  href="#planner" data-transition="slide"><img width="32px" height="32px" src="images/bangaway_planner.png" alt="details" class="cust_list_icon">Planner</a></li> -->
				<li data-icon="false"><a href="calendar.html" rel="external" data-ajax="false" data-transition="slide"><img width="32px" height="32px" src="images/bangaway_calendar.png" alt="details" class="cust_list_icon">Bang calendar</a></li>
				<li data-icon="false"><a href="bookHoliday.html#bookingHome" rel="external" data-ajax="false" data-transition="slide"><img width="32px" height="32px" src="images/bangaway_send.png" alt="details" class="cust_list_icon">Book day off</a></li>
				<li id="adminApproval" data-icon="false"><a id="apporvalNotify" href="approval.html" style="color:red" rel="external" data-ajax="false" data-transition="slide">
					<img width="32px" height="32px" src="images/bangaway_profile.png" alt="details" class="cust_list_icon">Approve Holidays<id class="counter" style="display:none">0</id></a>
				</li>
				<li data-icon="false"><a id="logout" href="index.html" rel="external" data-ajax="false" data-transition="slide"><img width="32px" height="32px" src="images/bangaway_profile.png" alt="details" class="cust_list_icon">Logout</a></li>
			</ul>
		</div>
	</div>


     	
	<!-- <div class="notif">notify me</div> -->

    <div class="notify-bot-cnt"></div> 

	<div data-role="footer" data-id="fhome" data-position="fixed">		
		<div data-role="navbar">
			<ul>
				<li><a href="#home" data-transition="slide"><img width="32px" height="28px" src="images/bangaway_home.png" alt="details"></a></li>
				<li><a href="map.html" rel="external" data-ajax="false"><img width="32px" height="28px" src="images/bangaway_groups.png" alt="details"></a></li>
				<li>
					<a id="notifications" href="notifications.html" rel="external" data-ajax="false">
						<img id="counterIcon" width="32px" height="28px" src="images/bangaway_chat.png" alt="details">
						<id class="Ncounter" style="display:none">0</id>
					</a>
				</li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_settings.png" alt="details"></a></li>
				<li><a href="#fcalendar" data-transition="slide"><img width="32px" height="28px" src="images/bangaway_keydates.png" alt="details"></a></li>
			</ul>
		</div> 
	</div><!-- /footer -->
</div>

<div data-role="page" id="planner" style="background-color:#ededeb;">
	<div data-role="content">	
		<div class="ui-grid-solo">
			<div class="ui-block-a"><h2 style="
					background-color: #ffdd00;
					font-weight:bold;
					height: 80px;
					margin-left: -20px;
					margin-right: -20px;
					margin-top: -14px;
					margin-bottom: -15px;
					padding-left: 30px;
					padding-top: 30px;">Planner</h2></div>
		</div>
		<div class="ui-grid-b">
			<div class="ui-block-a">
			   <a href="#">Today</a>
			</div>
			<div class="ui-block-b">
			   <a href="#">This Week</a>
			</div>  
			<div class="ui-block-c">
			   <a href="month.html" rel="external" data-ajax="false">This Month</a>
			</div>            
		</div> 
		<div class="ui-grid-solo" style="padding:5px; padding-top:20px">
			<div class="ui-block-a">
				<strong>Who's out today ?</strong>
				</br>
				<strong>6th June 2013</strong>
			</div>
		</div> 
		<div class="ui-grid-solo">
			<div class="ui-block-a">
			   <div class="tbl-container">
				   <table data-role="table" id="movie-table-custom" data-mode="reflow" class="movie-list table-stroke" >
					  <thead>
						<tr>
						  <th style="width:20%">Name</th>
						  <th data-priority="2">From date</th>
						  <th data-priority="3">To date</th>
						  <th data-priority="4" class="status">Status</th>
						</tr>
					  </thead>
					  <tbody>
						<tr>
						  <td class="title">Clair</td>
						  <td>1-06-2013</td>
						  <td>9-06-2013</td>
						  <td class="leave">Leave</td>
						</tr>
						<tr>
						  <td class="title">Peter</td>
						  <td>1-06-2013</td>
						  <td>9-06-2013</td>
						  <td class="leave">Leave</td>
						</tr>
						<tr>
						  <td class="title">Russell</td>
						  <td>6-06-2013</td>
						  <td>6-06-2013</td>
						  <td class="meeting">Meeting</td>
						</tr>
						<tr>
						  <td class="title">David</td>
						  <td>1-06-2013</td>
						  <td>9-06-2013</td>
						  <td class="leave">Leave</td>
						</tr>
					  </tbody>
					</table>
				</div>
			</div>
		</div>	


	</div>
	<div data-role="footer" data-id="fdetails" data-position="fixed">        
		<div data-role="navbar">
			<ul>
				<li><a href="#home" data-transition="slide"><img width="32px" height="28px" src="images/bangaway_home.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_groups.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_chat.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_settings.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_keydates.png" alt="details"></a></li>
			</ul>
		</div> 
	</div><!-- /footer -->
	<div data-role="panel" id="left-panel">
		   <div class="ui-grid-solo" style="padding:5px; padding-top:20px">
				<div class="ui-block-a">
					<strong>Who was out yesterday ?</strong>
					</br>
					<strong>5th June 2013</strong>
				</div>
			</div> 
			 <div class="tbl-container">
				   <table data-role="table" id="movie-table-custom" data-mode="reflow" class="movie-list table-stroke" >
					  <thead>
						<tr>
						  <th style="width:20%">Name</th>
						  <th data-priority="2">From date</th>
						  <th data-priority="3">To date</th>
						  <th data-priority="4" class="status">Status</th>
						</tr>
					  </thead>
					  <tbody>
						<tr>
						  <td class="title">Mark</td>
						  <td>5-06-2013</td>
						  <td>5-06-2013</td>
						  <td class="leave">Leave</td>
						</tr>
						<tr>
						  <td class="title">Peter</td>
						  <td>1-06-2013</td>
						  <td>9-06-2013</td>
						  <td class="leave">Leave</td>
						</tr>
					  </tbody>
					</table>
				</div>
	</div><!-- /panel -->
	<div data-role="panel" id="right-panel" data-display="push" data-position="right" >
		   <div class="ui-grid-solo" style="padding:5px; padding-top:20px">
				<div class="ui-block-a">
					<strong>Who was out yesterday ?</strong>
					</br>
					<strong>7th June 2013</strong>
				</div>
			</div>              
			 <div class="tbl-container">
				   <table data-role="table" id="movie-table-custom" data-mode="reflow" class="movie-list table-stroke" >
					  <thead>
						<tr>
						  <th style="width:20%">Name</th>
						  <th data-priority="2">From date</th>
						  <th data-priority="3">To date</th>
						  <th data-priority="4" class="status">Status</th>
						</tr>
					  </thead>
					  <tbody>
						<tr>
						  <td class="title">Sue</td>
						  <td>7-06-2013</td>
						  <td>7-06-2013</td>
						  <td class="meeting">Meeting</td>
						</tr>
						<tr>
						  <td class="title">Chris</td>
						  <td>7-06-2013</td>
						  <td>12-06-2013</td>
						  <td class="leave">Leave</td>
						</tr>
						<tr>
						  <td class="title">David</td>
						  <td>7-06-2013</td>
						  <td>7-06-2013</td>
						  <td class="leave">Leave</td>
						</tr>
					  </tbody>
					</table>
				</div>
	</div><!-- /panel -->
</div>

<div data-role="page" id="fcalendar">
  <div data-role="header">
  </div>
  <div data-role="content">
	<div class="ui-grid-solo">
			<div class="ui-block-a"><h2 style="
					background-color: #ffdd00;
					font-weight:bold;
					height: 80px;
					margin-left: -20px;
					margin-right: -20px;
					margin-top: -14px;
					margin-bottom: -15px;
					padding-left: 30px;
					padding-top: 30px;">Select a day to book off</h2>
				  </div>
		</div>
	<div class="ui-grid-solo">
	 <div class="ui-block-a" style="margin-left: -15px; margin-right: -15px;">
		<div id='fcalendarDisplay'></div>
	 </div>
   </div>
 </div>
	<div data-role="footer" data-id="fcalendar" data-position="fixed">        
		<div data-role="navbar">
			<ul>
				<li><a href="#home" data-transition="slide"><img width="32px" height="28px" src="images/bangaway_home.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_groups.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_chat.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_settings.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_keydates.png" alt="details"></a></li>
			</ul>
		</div> 
	</div><!-- /footer -->

</div>

</body>
</html>