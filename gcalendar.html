<!DOCTYPE html> 
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bang Away App</title>

<!--Jquery Mobile-->
<link href="css/jQuery/jquery.mobile.theme-1.3.1.min.css" rel="stylesheet" type="text/css"/>
<link href="css/jQuery/jquery.mobile.structure-1.3.1.min.css" rel="stylesheet" type="text/css"/>

<script src="lib/jQuery/jquery-1.10.0.min.js" type="text/javascript"></script>
<script src="lib/jQuery/jquery.mobile-1.3.1.js" type="text/javascript"></script>
<script src="lib/jQuery/jquery.mobile-1.3.1.min.js" type="text/javascript"></script>

<!--Jquery Custom-->
<link href="css/bangAway.css" rel="stylesheet" type="text/css">
<script src="lib/swipe.js" type="text/javascript"></script>

<link href='css/fullCalendar/fullcalendar.print.css' rel='stylesheet' media='print' />
<link href='css/fullCalendar/fullcalendar.css' rel='stylesheet' />
<script src='lib/fullCalendar/fullcalendar.min.js'></script>
<script src='lib/fullCalendar/gcal.js'></script>

<script>

if(localStorage['userID']==0)
{
  window.location.href = "index.html";
}

  $(document).ready(function() {
  
	
if(localStorage['newcountNotify'] != 0)
  {
	$('.Ncounter').text(localStorage['newcountNotify']).show(); 
  }
  else
  {
		$('this').removeClass('msg-iconh').addClass('msg-icon');
		$('.Ncounter').text('0').hide();
		$('.notif-bot').hide();
  }
  
  var notificationInterval = "http://www.paighaam.com/service/getNotifications.php?uid="+localStorage['userID']+"&state=1";
  var thetitle = $('title').text();
  

  setInterval(function(){

		jQuery.ajax({
		type: 'GET',
		url: notificationInterval,                                                                                                                                              
		dataType: 'jsonp', 
		  success: function(data) {
		var countNotif = parseInt($('.Ncounter').text());
		
		if(data.Count == 0 && countNotif >0)
		{
		  $('.Ncounter').text(0).hide();
		}

		if(data.Count != 0)
		{ 
		  if(data.Count > countNotif)
		  {
		  var newcountNotif = data.Count;
		  $('.Ncounter').text(newcountNotif).show();
		  localStorage['newcountNotify']= data.Count;
		  //$('Ntitle').text('('+newcountNotif+') '+thetitle);
		  
			jQuery('<div/>', {
			  id: 'notif-bot',
			  class : 'notif-bot alert alert-info',
			  text: 'You just got a notification!'
			  }).appendTo('.notify-bot-cnt')
			  .delay(5000)
			  .fadeOut();
		  }
		}
		  }
		});
	}, 5000 );

	
	$('#notifications').click(function(){
				$('this').removeClass('msg-iconh').addClass('msg-icon');
				$('.Ncounter').text('0').hide();
				$('.notif-bot').hide();
				$('title').text(thetitle);
				localStorage['newcountNotify'] = 0;
				setNotificationState();
			});

	   function setNotificationState()
	   {
		   var setNotificationCounter = "http://www.paighaam.com/service/setNotificationState.php?uid="+localStorage['userID'];

	  jQuery.ajax({

	  type: 'GET',
	  url: setNotificationCounter,                                                                                                                                              
	  dataType: 'jsonp',         
	  success: function(data)
	  { 

		console.log('Success!');

	  },
	  error: function() { console.log('Uh Oh Something Went Wrong!'); },

	  });
	}





	$('#fcalendarDisplay').fullCalendar({
	
	  // Private Calendar
	  events: 'https://www.google.com/calendar/feeds/mmev177niuorrf7nusuicpg9pc%40group.calendar.google.com/private-64e435707df95d1aff98100e11b446a5/basic',
	  header: {
	  left: 'prev,title,next',
	  center: '',
	  right: ''
	  },
	  eventClick: function(event) {
		// opens events in a popup window
		window.open(event.url, 'gcalevent', 'width=700,height=600');
		return false;
	  },
	  
	  loading: function(bool) {
		if (bool) {
		  $('#loading').show();
		}else{
		  $('#loading').hide();
		}
	  }
	  
	});
	
  });

</script>
<style>

  #loading {
	position: absolute;
	top: 5px;
	right: 5px;
	}

</style>

</head> 
<body> 


<div data-role="page" id="fcalendarbooking">
  <div data-role="header">
  </div>
  <div data-role="content">
	<div class="ui-grid-solo">
			<div class="ui-block-a"><h2 style="
					background-color: #ffdd00;
					font-weight:bold;
					height: 80px;
					margin-left: -20px;
					margin-right: -20px;
					margin-top: -14px;
					margin-bottom: -15px;
					padding-left: 30px;
					padding-top: 30px;">Bang's Google Calendar</h2>
				  </div>
		</div>

	<div class="ui-grid-solo">
	 <div class="ui-block-a" style="margin-left: -15px; margin-right: -15px;">
		<div id='loading' style='display:none'>loading...</div>
		 <div id='fcalendarDisplay'></div>
	 </div>
   </div>
 </div>
 <div class="notify-bot-cnt"></div> 
	<div data-role="footer" data-id="fcalendarbooking" data-position="fixed">        
		<div data-role="navbar">
			<ul>
				<li><a href="home.html" rel="external" data-ajax="false" data-transition="slide"><img width="32px" height="28px" src="images/bangaway_home.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_groups.png" alt="details"></a></li>
				<li>
					<a id="notifications" href="notifications.html" rel="external" data-ajax="false">
						<img id="counterIcon" width="32px" height="28px" src="images/bangaway_chat.png" alt="details">
						<id class="Ncounter" style="display:none">0</id>
					</a>
				</li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_settings.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_keydates.png" alt="details"></a></li>
			</ul>
		</div> 
	</div><!-- /footer -->

</div>

</body>


