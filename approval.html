<!DOCTYPE html> 
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bang Away App</title>

<!--Jquery Mobile-->
<link href="css/jQuery/jquery.mobile.theme-1.3.1.min.css" rel="stylesheet" type="text/css"/>
<link href="css/jQuery/jquery.mobile.structure-1.3.1.min.css" rel="stylesheet" type="text/css"/>

<script src="lib/jQuery/jquery-1.10.0.min.js" type="text/javascript"></script>
<script src="lib/jQuery/jquery.mobile-1.3.1.js" type="text/javascript"></script>
<script src="lib/jQuery/jquery.mobile-1.3.1.min.js" type="text/javascript"></script>

<!--Jquery Custom-->
<link href="css/bangAway.css" rel="stylesheet" type="text/css">
<script src="lib/swipe.js" type="text/javascript"></script>

<script>

if(localStorage['userID']==0)
{
	window.location.href = "index.html";
}

$(document).ready(function() {
		
		
		refreshPageAjax();

		function refreshPageAjax()
		{
		 var serviceURL = "http://www.paighaam.com/service/getHolidays.php?status=1";
	
		  jQuery.ajax({

			type: 'GET',
			url: serviceURL,                                                                                                                                              
			dataType: 'jsonp',         
			success: function(data)
			{ 
			  console.log('Success!');
			  populateRequests(data);
			},
			error: function() { console.log('Uh Oh Something Went Wrong!'); },

		  });
		}

		  function populateRequests(data)
		  {
		  	var length = data.length;
			$("tbody").empty();
		  	for(i=0; i<length;i++)
		  	{
		  		var startdate = new Date(data[i].DateFrom * 1000);
  				var sd = startdate.getDate();
				var sm = startdate.getMonth()+1;
				var sy = startdate.getFullYear();
				var stdate = sd +"/"+sm+"/"+sy;

		  		var enddate = new Date(data[i].DateTo * 1000);
  				var ed = enddate.getDate();
				var em = enddate.getMonth()+1;
				var ey = enddate.getFullYear();
				var endate = ed +"/"+em+"/"+ey;

	  			$("tbody").append('<tr><td class="title">' + data[i].Forename +" "+ data[i].Surname +'</td><td>'+ stdate +'</td><td>' + endate +'</td><td class="status"><a id="'+ data[i].RequestID +','+ data[i].UserID +'" class="approve">Approve</a> / <a id="'+ data[i].RequestID +','+ data[i].UserID +'" class="decline">Decline</a></td></tr>');
		  	}
		  }

		$(document).on('click', '.approve', function(e){
			var rid = $(this).attr("id").split(',')[0];
			var uid = $(this).attr("id").split(',')[1];
			processAction(rid,uid,"approve");
		});

		$(document).on('click', '.decline', function(e){
			var rid = $(this).attr("id").split(',')[0];
			var uid = $(this).attr("id").split(',')[1];
			processAction(rid,uid,"decline");
		});

		function processAction(rid,uid,state){
			
			if(state=="approve"){
				var serviceURL = "http://www.paighaam.com/service/processHoliday.php?rid="+ rid +"&status=2&uid="+ uid;
			}
			else
			{
			   var serviceURL = "http://www.paighaam.com/service/processHoliday.php?rid="+ rid +"&status=3&uid="+ uid;
			}

			  jQuery.ajax({

				type: 'GET',
				url: serviceURL,                                                                                                                                              
				dataType: 'jsonp',         
				success: function(data)
				{ 
				  console.log('Success!');
				  refreshPageAjax();
				},
				error: function() { console.log('Uh Oh Something Went Wrong!'); },

			  });
		}


		function updateAllowance()
		{

		 var serviceURL = "http://www.paighaam.com/service/getHolidays.php?status=1";
	
		  jQuery.ajax({

			type: 'GET',
			url: serviceURL,                                                                                                                                              
			dataType: 'jsonp',         
			success: function(data)
			{ 
			  console.log('Success!');
			  populateRequests(data);
			},
			error: function() { console.log('Uh Oh Something Went Wrong!'); },

		  });
		}
});



</script>

<style>
	.approve
	{
		color:blue;
	}

	.decline
	{
		color:red;
	}

	.#requestData tr:hover
	{
		background-color:red;
	}
</style>

</head> 
<body> 

<div data-role="page" id="planner" style="background-color:#ededeb;">
	<div data-role="content">	
		<div class="ui-grid-solo">
			<div class="ui-block-a"><h2 style="
					background-color: #ffdd00;
					font-weight:bold;
					height: 80px;
					margin-left: -20px;
					margin-right: -20px;
					margin-top: -14px;
					margin-bottom: -15px;
					padding-left: 30px;
					padding-top: 30px;">Holiday</h2></div>
		</div>
		<div class="ui-grid-solo" style="padding:5px; padding-top:20px">
			<div class="ui-block-a">
				</br>
				<strong>Below is the list of holday requests</strong>
				</br>
				<strong>Approve / Reject </strong>
			</div>
		</div> 
		<div class="ui-grid-solo">
			<div class="ui-block-a">
			   <div class="tbl-container">
				   <table data-role="table" id="approvalData" data-mode="reflow" class="movie-list table-stroke" >
					  <thead>
						<tr>
						  <th style="width:20%">Name</th>
						  <th data-priority="2">From date</th>
						  <th data-priority="3">To date</th>
						  <th data-priority="4" class="status">Status</th>
						</tr>
					  </thead>
					  <tbody id="requestData">
					  </tbody>
					</table>
				</div>
			</div>
		</div>	
	</div>
	<div data-role="footer" data-id="fdetails" data-position="fixed">        
		<div data-role="navbar">
			<ul>
				<li><a href="home.html" rel="external" data-ajax="false" data-transition="slide"><img width="32px" height="28px" src="images/bangaway_home.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_groups.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_chat.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_settings.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_keydates.png" alt="details"></a></li>
			</ul>
		</div> 
	</div><!-- /footer -->
	
</div>


</body>
</html>
