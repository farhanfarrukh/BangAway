<!DOCTYPE html> 
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bang Away App</title>

<!--Jquery Mobile-->
<link href="css/jQuery/jquery.mobile.theme-1.3.1.min.css" rel="stylesheet" type="text/css"/>
<link href="css/jQuery/jquery.mobile.structure-1.3.1.min.css" rel="stylesheet" type="text/css"/>

<script src="lib/jQuery/jquery-1.10.0.min.js" type="text/javascript"></script>
<script src="lib/jQuery/jquery.mobile-1.3.1.js" type="text/javascript"></script>
<script src="lib/jQuery/jquery.mobile-1.3.1.min.js" type="text/javascript"></script>

<!--Jquery Custom-->
<link href="css/bangAway.css" rel="stylesheet" type="text/css">
<script src="lib/swipe.js" type="text/javascript"></script>

<!-- NOTE: JQMdateBox -->

<link type="text/css" href="css/JQMdatebox/jqm-datebox.min.css" rel="stylesheet" /> 
<link type="text/css" href="css/JQMdatebox/jquery.mobile.simpledialog.min.css" rel="stylesheet" /> 

<!-- NOTE: Script load order is significant! I really struggled to get the order right-->

<script type="text/javascript" src="lib/JQMdatebox/jquery.mousewheel.min.js"></script>
<script type="text/javascript" src="lib/JQMdatebox/jqm-datebox.core.min.js"></script>
<script type="text/javascript" src="lib/JQMdatebox/jqm-datebox.mode.calbox.min.js"></script>
<script type="text/javascript" src="lib/JQMdatebox/jqm-datebox.mode.datebox.min.js"></script>
<script type="text/javascript" src="lib/JQMdatebox/jqm-datebox.mode.flipbox.min.js"></script>
<script type="text/javascript" src="lib/JQMdatebox/jqm-datebox.mode.durationbox.min.js"></script>
<script type="text/javascript" src="lib/JQMdatebox/jqm-datebox.mode.slidebox.min.js"></script>
<script type="text/javascript" src="lib/JQMdatebox/jquery.mobile.datebox.i18n.en_US.utf8.js"></script>

<script type="text/javascript" src="lib/JQMdatebox/jquery.mobile.simpledialog.min.js"></script>
<script type="text/javascript" src="http://dev.jtsage.com/gpretty/prettify.js"></script>


<script>

if(localStorage['userID']==0)
{
	window.location.href = "index.html";
}

$(document).ready(function() {
		
	if(localStorage['newcountNotify'] != 0)
	{
		$('.Ncounter').text(localStorage['newcountNotify']).show();	
	}
	else
	{
        $('this').removeClass('msg-iconh').addClass('msg-icon');
        $('.Ncounter').text('0').hide();
        $('.notif-bot').hide();
	}
	
	var notificationInterval = "http://www.paighaam.com/service/getNotifications.php?uid="+localStorage['userID']+"&state=1";
	var thetitle = $('title').text();
	

	setInterval(function(){

		    jQuery.ajax({
				type: 'GET',
				url: notificationInterval,                                                                                                                                              
				dataType: 'jsonp', 
		      success: function(data) {
				var countNotif = parseInt($('.Ncounter').text());
				
				if(data.Count == 0 && countNotif >0)
				{
					$('.Ncounter').text(0).hide();
				}

				if(data.Count != 0)
				{	
					if(data.Count > countNotif)
					{
					var newcountNotif = data.Count;
					$('.Ncounter').text(newcountNotif).show();
					localStorage['newcountNotify']= data.Count;
					//$('Ntitle').text('('+newcountNotif+') '+thetitle);
					
						jQuery('<div/>', {
							id: 'notif-bot',
							class : 'notif-bot alert alert-info',
							text: 'You just got a notification!'
							}).appendTo('.notify-bot-cnt')
							.delay(5000)
							.fadeOut();
					}
				}
		      }
		    });
		}, 5000 );

		
		$('#notifications').click(function(){
                $('this').removeClass('msg-iconh').addClass('msg-icon');
                $('.Ncounter').text('0').hide();
                $('.notif-bot').hide();
                $('title').text(thetitle);
                localStorage['newcountNotify'] = 0;
                setNotificationState();
            });

       function setNotificationState()
       {
           var setNotificationCounter = "http://www.paighaam.com/service/setNotificationState.php?uid="+localStorage['userID'];

		  jQuery.ajax({

			type: 'GET',
			url: setNotificationCounter,                                                                                                                                              
			dataType: 'jsonp',         
			success: function(data)
			{ 

			  console.log('Success!');

			},
			error: function() { console.log('Uh Oh Something Went Wrong!'); },

		  });
		}


		$("#bookbtn").click(function() {
			var userID = localStorage['userID'];
			var desc = $("#desc").val();
			var dateFrom = unixTimestamp($("#dateFrom").val());
			var dateTo = unixTimestamp($("#dateTo").val());
			var leavetype = "Annual";
			var serviceURL = "http://www.paighaam.com/service/requestHoliday.php?userID=" + userID + "&leavetype=" + leavetype + "&dateFrom=" + dateFrom + "&dateTo=" + dateTo + "&desc=" + desc;

		  jQuery.ajax({
		  type: 'GET',
		  url: serviceURL,                                                                                                                                              
		  dataType: 'jsonp',         
		  success: function(data)
		  { 		   
		   if(data != false){
			console.log('Success!');
			window.location.replace("calendar.html");
		  }
		  else
		  {
			alert("Something went wrong !!!");
		  }

		  },
		  error: function() { console.log('Uh Oh Something Went Wrong!'); },

		  });

	function unixTimestamp(date)
	{
	  dateString = date.split(' ').join('T');
	  var date = new Date(dateString);
	  date = date.getTime() / 1000;
	  return date;
	}

	});

});

</script>


</head> 
<body> 

<div data-role="page" id="bookingHome">
  <div data-role="header">
  </div>
  <div data-role="content">
		<div class="ui-grid-solo">
				<div class="ui-block-a"><h2 style="
						background-color: #ffdd00;
						font-weight:bold;
						height: 80px;
						margin-left: -20px;
						margin-right: -20px;
						margin-top: -14px;
						margin-bottom: -15px;
						padding-left: 30px;
						font-size:30px;
						padding-top: 30px;">Annual Leave</h2>
				</div>
		</div>
		<div class="ui-grid-solo" style="padding:5px; padding-top:20px">
			<div class="ui-block-a">
				<strong>Please choose what you</strong>
				</br>
				<strong>would like to do ?</strong>
			</div>
		</div>
		<div class="ui-grid-solo" style="padding:5px; padding-top:20px">
			<div class="ui-block-a">
			<ul data-role="listview">
				<li data-icon="false"><a href="bookHoliday.html" rel="external" data-ajax="false" data-transition="slide">Book a half day</a></li>
				<li data-icon="false"><a href="bookHoliday.html" rel="external" data-ajax="false" data-transition="slide">Book a whole day</a></li>		
				<li data-icon="false"><a href="bookHoliday.html#multipleDays" data-transition="slide">Book multiple days</a></li>
				<li data-icon="false"><a href="bookHoliday.html" rel="external" data-ajax="false" data-transition="slide">Book a meeting out of office</a></li>
			</ul>
			</div>
		</div> 

 </div>
	<div class="notify-bot-cnt"></div> 
	<div data-role="footer" data-id="fcalendarbooking" data-position="fixed">        
		<div data-role="navbar">
			<ul>
				<li><a href="home.html" rel="external" data-ajax="false" data-transition="slide"><img width="32px" height="28px" src="images/bangaway_home.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_groups.png" alt="details"></a></li>
				<li>
					<a id="notifications" href="notifications.html" rel="external" data-ajax="false">
						<img id="counterIcon" width="32px" height="28px" src="images/bangaway_chat.png" alt="details">
						<id class="Ncounter" style="display:none">0</id>
					</a>
				</li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_settings.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_keydates.png" alt="details"></a></li>
			</ul>
		</div> 
	</div><!-- /footer -->

</div>

<div data-role="page" id="multipleDays">
  <div data-role="header">
  </div>
  
  <div data-role="content">
	<div class="ui-grid-solo">
			<div class="ui-block-a"><h2 style="
					background-color: #ffdd00;
					font-weight:bold;
					height: 80px;
					margin-left: -20px;
					margin-right: -20px;
					margin-top: -14px;
					margin-bottom: -15px;
					padding-left: 30px;
					padding-top: 30px;">Select Date</h2>
				  </div>
	</div>

	<div class="ui-grid-solo">
		<div class="ui-block-a">
			<label for="desc">Description</label>
			<input name="desc" id="desc" type="text">
		</div>
	</div>

	<div class="ui-grid-solo">
		<div class="ui-block-a">
			<label for="mydate">From</label>
			<input name="dateFrom" id="dateFrom" type="date" data-role="datebox" data-theme="d" data-options='{"mode": "flipbox"}'>
		</div>
	</div>

	<div class="ui-grid-solo">		
		<div class="ui-block-a">
			<label for="mydate">To</label>
			<input name="dateTo" id="dateTo" type="date" data-role="datebox" data-theme="d" useModal data-options='{"mode": "flipbox","useModal":"true"}'>
		</div>
	</div>

	<div class="ui-grid-solo">
	</br>
    	<div class="ui-block-a"><button id="bookbtn" type="button" data-theme="b">BOOK HOLIDAY</button></div>
	</div>


</div>
	<div class="notify-bot-cnt"></div> 
	<div data-role="footer" data-id="fcalendarbooking" data-position="fixed">        
		<div data-role="navbar">
			<ul>
				<li><a href="home.html" rel="external" data-ajax="false" data-transition="slide"><img width="32px" height="28px" src="images/bangaway_home.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_groups.png" alt="details"></a></li>
				<li>
					<a id="notifications" href="notifications.html" rel="external" data-ajax="false">
						<img id="counterIcon" width="32px" height="28px" src="images/bangaway_chat.png" alt="details">
						<id class="Ncounter" style="display:none">0</id>
					</a>
				</li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_settings.png" alt="details"></a></li>
				<li><a href="#"><img width="32px" height="28px" src="images/bangaway_keydates.png" alt="details"></a></li>
			</ul>
		</div> 
	</div><!-- /footer -->

</div>

</body>


